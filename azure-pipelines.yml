trigger:
  branches:
    include: [main]

pr:
  branches:
    include: [main]

pool:
  vmImage: "ubuntu-latest"

steps:
  - script: curl -LsSf https://astral.sh/uv/0.6.3/install.sh | sh && echo "##vso[task.prependpath]$HOME/.local/bin"
    displayName: "Install uv (pinned v0.6.3)"
  - script: uv sync
    displayName: "Install dependencies"
  - script: uv run ruff check .
    displayName: "Lint"
  - script: uv run ruff format --check .
    displayName: "Format check"
  - script: uv run mypy src/
    displayName: "Type check"
  - script: uv run pytest --cov --cov-report=xml --cov-report=term
    displayName: "Test + coverage"
  - task: PublishCodeCoverageResults@2
    inputs:
      summaryFileLocation: "$(System.DefaultWorkingDirectory)/coverage.xml"
    condition: succeededOrFailed()
